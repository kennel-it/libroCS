<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html>
<!-- autoIndex requires="json" group="javascript" coords="60,30" -->
<!-- changelog 2018-02-21 inserita prima parte dei contenuti -->
<!-- changelog 2020-03-01 inseriti link, alcune precisazioni e rimosso "work in progress" -->
<!-- changelog 2023-04-17 sistemazione generale e aggiunto stringify -->
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
   	<meta charset="UTF-8"/>
       <title>elaborazioneJsonClient</title>
       <link type="text/css" rel="stylesheet" href="style.css"/>
       <script type="text/javascript" src="script/test.js"></script>         
   </head>
<body>
<header>
	<h1>elaborazioneJsonClient</h1>
	<p>gestire una risposta in formato application/json via JavaScript</p>
</header>
<article>
	<p>Come linguaggio lato client prendiamo in considerazione soltanto JavaScript 
	in cui la gestione dei messaggi JSON è davvero semplice ma praticamente
	per tutti i linguaggi esistono librerie per fare le cose che vediamo qui sotto.</p>
	
	<p>Il nome stesso del formato (JavaScript Object Notation) 
	ci da indicazioni sulla sua semplicità di uso con JavaScript che
	ci mette a disposizione un oggetto predefinito 
	<a href="https://developer.mozilla.org/it/docs/Web/JavaScript/Reference/Global_Objects/JSON">JSON</a>
	per trasformare un testo JSON in un oggetto e viceversa.</p>
	
	<h2>JSON → oggetto JS</h2>
	
	<p>Per convertire una stringa in un oggetto basta usare il metodo
	<code>parse()</code> dell'oggetto <code>JSON</code>,
	<code>JSON.parse(testo)</code> restituisce un oggetto costruito come specificato
	nella stringa <code>testo</code>.</p>

	<p>Normalmente il messaggio JSON viene da un server o da un sistema di archiviazione
	ma nella sostanza il modo di lavorarci è quello qui sotto:</p>

<div class="prog">
// invento un messaggio
let messaggioDalServer = '{ "nome":"Pluto", "telefoni": ["555-1111","555-2222"] }';
// trasformo il testo in un oggetto
let oggetto = JSON.parse(messaggioDalServer);
console.log(oggetto.telefoni[1]);
</div>
	<div class="test">
	   	<p>Cosa stampa il precedente frammento di programma nella console?</p>
	    <a onclick="sbagliata(this)">Pluto 555-2222<span class="spiegazione">no, il nome non viene stampatohernet</span></a>
	    <a onclick="sbagliata(this)">555-1111<span class="spiegazione">questo sarebbe l'indice zero</span></a> 
	    <a onclick="giusta(this)">555-2222</a> 
	</div>
	
	<div class="test">
	   	<p>Cosa stampa il precedente frammento di programma nella console?</p>
	    <a onclick="sbagliata(this)">nome<span class="spiegazione">no, la proprietà "Pluto" non esiste</span></a>
	    <a onclick="sbagliata(this)">stringa vuota<span class="spiegazione">no, c'è un valore specifico</span></a> 
	    <a onclick="giusta(this)">undefined</a> 
	</div>
	
	
	<h2>Oggetto JS → JSON</h2>
	<p>Anche in questo caso piuttosto facile: <code>JSON.stringify(oggetto)</code>
	restituisce una stringa che è la rappresentazione delle proprietà di <code>oggetto</code>.
	Vediamo subito come funziona con un frammento di programma</p>
	
<div class="prog">
let oggetto = {nome: "Batman"};
oggetto.citta = "Gotham";
oggetto.attori = ["Christian Bale","Val Kilmer"];
let testo = JSON.stringify(oggetto);</div>

    <p>la variabile testo conterrà:</p>
<pre>{
  "nome": "Batman",
  "citta": "Gotham",
  "attori": [
    "Christian Bale",
    "Val Kilmer"
  ]
}</pre>

    <p>In effetto il frammento di programma sopra si potrebbe anche scrivere:</p>
    <div class="prog">let oggetto = {nome: "Batman", citta: "Gotham", attori : ["Christian Bale","Val Kilmer"]};
let testo = JSON.stringify(oggetto);</div>

</article>
</body>
</html>