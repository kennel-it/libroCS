<!DOCTYPE html>
<!-- autoIndex requires="architettureServizi" group="servizi" coords="60,50" -->
<!-- changelog 2021-12-09 prima introduzione del capitolo -->
<!-- changelog 2025-08-22 praticamente riscritto il capitolo -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>applicationServer</title>
    <link type="text/css" rel="stylesheet" href="style.css"/>
    <script type="text/javascript" src="script/test.js"></script>
</head>
<body>
<header>
	<h1>applicationServer</h1>
	<p>un supporto per scrivere applicazioni web</p>
</header>
<article>
	<h2>Cosa sono</h2>
	<p>Sono applicazioni che forniscono contenuti via HTTP... detto così sembrano molto simili ad
	<em>Apache httpd</em> e in effetti per alcuni parametri lo sono ma se <em>httpd</em> è pensato
	per fornire ai client dei file presenti su disco (è poi vero che esistono tantissime
	estensioni che ad esempio gli permettono di eseguire script PHP) un application server è pensato per
	eseguire applicazioni che genereranno un qualche tipo di output che viene fornito al client.</p>
	<p>Questi server offrono un elevato numero di comode funzioni per poter scrivere e mantenere
	facilmente applicazioni lato server anche di grandi dimensioni, in questa breve introduzione daremo uno sguardo
	a quei server che ci permettono di scrivere i programmi in Java. Ne esistono diversi tipi che offrono
	diverse categorie di servizi (ad esempio autenticare gli utenti o la gestione delle transazioni),
    noi prendiamo in considerazione il profilo web (quello di base) che va bene per muovere
    i primi passi.</p>
	
	<h2><a href="http://tomcat.apache.org/"><img src="immagini/logo_Apache_Tomcat.png" alt="tomcat"/>Tomcat</a></h2>
    <p>Tomcat necessita di pochissima configurazione e seguendo linee standard
    può essere sotituito da altri programmi con le sue stesse funzioni in pratica a costo zero,
    <a hreF="https://javaee.github.io/glassfish/">GlassFish</a> è un esempio di alternativa.</p>

	<p>Una volta scaricato il pacchetto (.zip va bene per Windows, megio .tar.gz per Linux o macOS)
	basta scompattarlo e fare un minimo di configurazione.
    Per poter partire Tomcat ha bisogno di sapere dove si trova Java: se il sistema operativo
    ha già configurata la variabile d'ambiente <code>JAVA_HOME</code> non serve fare nulla
    altrimenti lo possiamo indicare utilizzando una variabile di ambiente chiamata <code>JAVA_HOME</code>
    nel file <code>setenv.sh</code> (o setenv.bat per Windows) che deve trovarsi sempre nella cartella bin,
    il file conterrà semplicemente una riga:</p>
    <pre>JAVA_HOME=/percorso/cartella/jdk-21</pre>

    <p>Per avviare il server bisogna lanciare il programma
	<code>startup.bat</code> in Windows o <code>startup.sh</code> su Linux o macOS
	che si trova nella cartella <code>bin</code>. Per fermare il server usare 
    <code>shutdown.sh</code>. Anche se il comando per avviare/fermare Tocat
    termina questo non vuol dire che il server non sia partito, per
    provarlo basta collegarsi all'indirizzo <code>http://localhost:8080</code>.</p>

	<h2>Hello World!</h2>
	<p>Come esempio creiamo un oggetto che si chiama
	"<a href="https://it.wikipedia.org/wiki/Servlet"></a>Servlet" che è in grado di rispondere
	sia a richieste di tipo GET che POST, seguiamo un procedimento che richiede
    meno strumenti e impostazioni possibile.</p>
	<p><img src="immagini/eclipse_jakartaEE.png" style="float:right; margin-left:1em"
    alt="progetto Jakarta Enterprise in Ecipse">
    Usiamo Eclipse, fa comodo avere la versione <em>Enterprise Java</em> (
    dalla pagina dei <a href="https://www.eclipse.org/downloads/packages/">download</a>).
    Creiamo un nuovo progetto: click sul menu <em>File&gt;New...&gt;Project...</em>, 
    dalla finestra di disalogo che si apre dal gruppo <em>web</em>
    selezionare <em>Dynamic Web Project</em>, basta mettere "hello" come nome
    del progetto e lasciare le impostazioni di default.</p>
    <p>Nella vista "Project Explorer" (l'immagine qui a fianco)
    di Eclipse i sorgenti java compaiono in entrambe le due cartelle
    evidenziatge in giallo, si possono usare indifferentemente.</p>
	<p>L'applicazione di esempio risponde con due diversi messaggi a seconda che
    venga chiamata con il metodo GET o POST, per fare questo basta creare una classe
    che chiamiamo <code>HelloWorld</code> (in qualsiasi pacchetto):</p>

<h3 style="clear:both">HelloWorld.java</h3>
<pre><code>
package it.esempi;

import java.io.IOException;
import java.io.Writer;

import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

@WebServlet("/saluto")
public class HelloWorld extends HttpServlet {

    private static final long serialVersionUID = 1L;

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException{
        Writer uscita = response.getWriter();
        uscita.append("richiesta GET");
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException {
        response.setContentType("text/html");
        response.getWriter().append("richiesta POST");
    }
}
</code></pre>

    <p>Se abbiamo fatto tutto in ordine dovremmo avere tantissimi errori nella classe... 
    questo perché stiamo utilizzando degli oggetti che non sono presenti
    nella libreria base di Java. In eclipse correggere il problema non  è difficile:
    basta aprire le proprietà del progetto, andare nella sezione "Java build path"
    nella pagina delle librerie. Click sul pulsante "add External Jars"
    e aggiungere uno specifico jar che si chiama <code>servlet-api.jar</code>
    e si trova nella cartella lib di Tomcat.</p>

    <h2>Pubblicazione</h2>
    <p>Pubblicare una applicazione vuol dire renderla disponibile per i client e in pratica
    tutto sta nel copiare un file in una sottocartella di Tomcat.</p>
    <p>Eclipse è un grado di produrre il file che ci serve a partire dal nostro progetto
    inserendo tutto quello che serve, in genere potrebbero esserci anche pagine html e diversi
    altri tipi di file ma nel nostro caso in pratica ci sarà la classe 
    <code>HelloWorld</code> compilata e pochissimo altro.
    Selezionare il progetto e poi <em>File>Export...</em>, dal dialogo che si apre selezionare
    <em>WAR file</em> dal gruppo Web. Va selezionata la cartella di destinazione
    e lasciato tutto il resto come è di default, alla fine si otterrà un file
    <code>hello.war</code>.</p>
    <p>Il file war appena creato va copiato nella cartella <code>webapps</code>
    di Tomcat che va poi avviato.</p>

    <h2>Test</h2>
    <p>Per provare (almeno il metodo GET) basta usare un browser: nella barra delle
    URL l'indirizzo da scrivere è <code>http://localhost:8080/hello/saluto</code>
    come si vede nella URL "hello" è il nome del progetto e "saluto" è il percorso
    indicato usando l'annotazione <code>@WebServlet</code> nella creazione della classe.</p>


</article>
</body>
</html>